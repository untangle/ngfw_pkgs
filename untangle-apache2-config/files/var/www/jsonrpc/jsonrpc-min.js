var escapeJSONChar=function(){var a=["\b","\t","\n","\f","\r"];return function(d){if(d=='"'||d=="\\"){return"\\"+d}if(d.charCodeAt(0)>=32){return d}for(var b=0;b<a.length;b++){if(d==a[b]){return"\\"+d}}return d}}();function escapeJSONString(b){var c=b.split("");for(var a=0;a<c.length;a++){c[a]=escapeJSONChar(c[a])}return'"'+c.join("")+'"'}function toJSON(f){var a="$_$jabsorbed$813492";var h;var e=[];function c(){var i;while(h){i=h[a].prev;delete h[a];h=i}}var g={};var b;function d(k,j,l){var u=[],n,m,t,r,q;if(k===null||k===undefined){return"null"}else{if(typeof k==="string"){return escapeJSONString(k)}else{if(typeof k==="number"){return k.toString()}else{if(typeof k==="boolean"){return k.toString()}else{if(k[a]){n=[l];t=j;while(t){if(m){m.unshift(t[a].ref)}if(t===k){r=t;m=[r[a].ref]}n.unshift(t[a].ref);t=t[a].parent}if(r){if(JSONRpcClient.fixupCircRefs){n.shift();m.shift();e.push([n,m]);return g}else{c();throw new Error("circular reference detected!")}}else{if(JSONRpcClient.fixupDuplicates){m=[k[a].ref];t=k[a].parent;while(t){m.unshift(t[a].ref);t=t[a].parent}n.shift();m.shift();e.push([n,m]);return g}}}else{k[a]={parent:j,prev:h,ref:l};h=k}if(k.constructor===Date){return'{javaClass: "java.util.Date", time: '+k.valueOf()+"}"}else{if(k.constructor===Array){for(q=0;q<k.length;q++){b=d(k[q],k,q);u.push(b===g?null:b)}return"["+u.join(", ")+"]"}else{for(var s in k){if(s===a){}else{if(k[s]===null||k[s]===undefined){u.push('"'+s+'": null')}else{if(typeof k[s]=="function"){}else{b=d(k[s],k,s);if(b!==g){u.push(escapeJSONString(s)+": "+b)}}}}}return"{"+u.join(", ")+"}"}}}}}}}b=d(f,null,"root");c();if(e.length){return{json:b,fixups:e}}else{return{json:b}}}function JSONRpcClient(){var b=0,f,a,d,c;if(typeof arguments[0]=="function"){this.readyCB=arguments[0];b++}this.serverURL=arguments[b];this.user=arguments[b+1];this.pass=arguments[b+2];this.objectID=arguments[b+3];this.javaClass=arguments[b+4];this.JSONRPCType=arguments[b+5];if(JSONRpcClient.knownClasses[this.javaClass]&&(this.JSONRPCType=="CallableReference")){for(var e in JSONRpcClient.knownClasses[this.javaClass]){a=JSONRpcClient.knownClasses[this.javaClass][e];this[e]=JSONRpcClient.bind(a,this)}}else{if(this.objectID){this._addMethods(["listMethods"],this.javaClass);f=this._makeRequest("listMethods",[])}else{this._addMethods(["system.listMethods"],this.javaClass);f=this._makeRequest("system.listMethods",[])}if(this.readyCB){c=this;f.cb=function(g,h){if(!h){c._addMethods(g)}c.readyCB(g,h)}}d=this._sendRequest(f);if(!this.readyCB){this._addMethods(d,this.javaClass)}}}JSONRpcClient.knownClasses={};JSONRpcClient.Exception=function(e,d,c){this.code=e;var b,a;if(c){this.javaStack=c;a=c.match(/^([^:]*)/);if(a){b=a[0]}}if(b){this.name=b}else{this.name="JSONRpcClientException"}this.message=d};JSONRpcClient.Exception.CODE_REMOTE_EXCEPTION=490;JSONRpcClient.Exception.CODE_ERR_CLIENT=550;JSONRpcClient.Exception.CODE_ERR_PARSE=590;JSONRpcClient.Exception.CODE_ERR_NOMETHOD=591;JSONRpcClient.Exception.CODE_ERR_UNMARSHALL=592;JSONRpcClient.Exception.CODE_ERR_MARSHALL=593;JSONRpcClient.Exception.prototype=new Error();JSONRpcClient.Exception.prototype.toString=function(a,b){return this.name+": "+this.message};JSONRpcClient.default_ex_handler=function(a){message=a.toString();if(a.lineNumber&&a.fileName){message=message+" "+i18n._("on line")+" "+a.lineNumber+" "+i18n._("in file")+" "+a.fileName}if(a.stack){message=message+" "+a.stack}alert(message)};JSONRpcClient.toplevel_ex_handler=JSONRpcClient.default_ex_handler;JSONRpcClient.profile_async=false;JSONRpcClient.max_req_active=2;JSONRpcClient.requestId=1;JSONRpcClient.fixupCircRefs=true;JSONRpcClient.fixupDuplicates=true;JSONRpcClient.bind=function(b,a){return function(){return b.apply(a,arguments)}};JSONRpcClient.prototype._createMethod=function(b){var a=function(){var c=[],f;for(var d=0;d<arguments.length;d++){c.push(arguments[d])}if(typeof c[0]=="function"){f=c.shift()}var e=this._makeRequest.call(this,b,c,f);if(!f){return this._sendRequest.call(this,e)}else{JSONRpcClient.async_requests.push(e);JSONRpcClient.kick_async();return e.requestId}};return a};JSONRpcClient.prototype._addMethods=function(c,h){var a,e,d,g,f;if(h){JSONRpcClient.knownClasses[h]={}}for(var b=0;b<c.length;b++){e=this;d=c[b].split(".");for(g=0;g<d.length-1;g++){a=d[g];if(e[a]){e=e[a]}else{e[a]={};e=e[a]}}a=d[d.length-1];if(!e[a]){f=this._createMethod(c[b]);e[a]=JSONRpcClient.bind(f,this);if(h&&(a!="listMethods")){JSONRpcClient.knownClasses[h][a]=f}}}};JSONRpcClient._getCharsetFromHeaders=function(a){var f,d,b;try{f=a.getResponseHeader("Content-type");d=f.split(/\s*;\s*/);for(b=0;b<d.length;b++){if(d[b].substring(0,8)=="charset="){return d[b].substring(8,d[b].length)}}}catch(c){}return"UTF-8"};JSONRpcClient.async_requests=[];JSONRpcClient.async_inflight={};JSONRpcClient.async_responses=[];JSONRpcClient.async_timeout=null;JSONRpcClient.num_req_active=0;JSONRpcClient._async_handler=function(){var a,b;JSONRpcClient.async_timeout=null;while(JSONRpcClient.async_responses.length>0){a=JSONRpcClient.async_responses.shift();if(a.canceled){continue}if(a.profile){a.profile.dispatch=new Date()}try{a.cb(a.result,a.ex,a.profile)}catch(c){JSONRpcClient.toplevel_ex_handler(c)}}while(JSONRpcClient.async_requests.length>0&&JSONRpcClient.num_req_active<JSONRpcClient.max_req_active){b=JSONRpcClient.async_requests.shift();if(b.canceled){continue}b.client._sendRequest.call(b.client,b)}};JSONRpcClient.kick_async=function(){if(!JSONRpcClient.async_timeout){JSONRpcClient.async_timeout=setTimeout(JSONRpcClient._async_handler,0)}};JSONRpcClient.cancelRequest=function(b){if(JSONRpcClient.async_inflight[b]){JSONRpcClient.async_inflight[b].canceled=true;return true}var a;for(a in JSONRpcClient.async_requests){if(JSONRpcClient.async_requests[a].requestId==b){JSONRpcClient.async_requests[a].canceled=true;return true}}for(a in JSONRpcClient.async_responses){if(JSONRpcClient.async_responses[a].requestId==b){JSONRpcClient.async_responses[a].canceled=true;return true}}return false};JSONRpcClient.prototype._makeRequest=function(b,d,a){var e={};e.client=this;e.requestId=JSONRpcClient.requestId++;var f='{"id":'+e.requestId+',"method":';if(this.objectID){f+='".obj#'+this.objectID+"."+b+'"'}else{f+='"'+b+'"'}if(a){e.cb=a}if(JSONRpcClient.profile_async){e.profile={submit:new Date()}}var c=toJSON(d);f+=',"params":'+c.json;if(c.fixups){f+=',"fixups":'+toJSON(c.fixups).json}e.data=f+"}";return e};JSONRpcClient.prototype._sendRequest=function(c){var b,a;if(c.profile){c.profile.start=new Date()}b=JSONRpcClient.poolGetHTTPRequest();JSONRpcClient.num_req_active++;b.open("POST",this.serverURL,!!c.cb,this.user,this.pass);try{b.setRequestHeader("Content-type","text/plain")}catch(d){}if(c.cb){a=this;b.onreadystatechange=function(){var f;if(b.readyState==4){b.onreadystatechange=function(){};f={cb:c.cb,result:null,ex:null};if(c.profile){f.profile=c.profile;f.profile.end=new Date()}else{f.profile=false}try{f.result=a._handleResponse(b)}catch(g){f.ex=g}if(!JSONRpcClient.async_inflight[c.requestId].canceled){JSONRpcClient.async_responses.push(f)}delete JSONRpcClient.async_inflight[c.requestId];JSONRpcClient.kick_async()}}}else{b.onreadystatechange=function(){}}JSONRpcClient.async_inflight[c.requestId]=c;try{b.send(c.data)}catch(d){JSONRpcClient.poolReturnHTTPRequest(b);JSONRpcClient.num_req_active--;throw new JSONRpcClient.Exception(JSONRpcClient.Exception.CODE_ERR_CLIENT,"Connection failed")}if(!c.cb){delete JSONRpcClient.async_inflight[c.requestId];return this._handleResponse(b)}return null};JSONRpcClient.prototype._handleResponse=function(http){function applyFixups(obj,fixups){function findOriginal(ob,original){for(var i=0,j=original.length;i<j;i++){ob=ob[original[i]]}return ob}function applyFixup(ob,fixups,value){var j=fixups.length-1;for(var i=0;i<j;i++){ob=ob[fixups[i]]}ob[fixups[j]]=value}for(var i=0,j=fixups.length;i<j;i++){applyFixup(obj,fixups[i][0],findOriginal(obj,fixups[i][1]))}}if(!this.charset){this.charset=JSONRpcClient._getCharsetFromHeaders(http)}var status,statusText,data;try{status=http.status;statusText=http.statusText;data=http.responseText}catch(e){JSONRpcClient.poolReturnHTTPRequest(http);JSONRpcClient.num_req_active--;JSONRpcClient.kick_async();throw new JSONRpcClient.Exception(JSONRpcClient.Exception.CODE_ERR_CLIENT,"Connection failed")}JSONRpcClient.poolReturnHTTPRequest(http);JSONRpcClient.num_req_active--;if(status!=200){throw new JSONRpcClient.Exception(status,statusText)}var obj;try{eval("obj = "+data)}catch(e){throw new JSONRpcClient.Exception(550,"error parsing result")}if(obj.error){throw new JSONRpcClient.Exception(obj.error.code,obj.error.msg,obj.error.trace)}var r=obj.result;var i,tmp;if(r){if(r.objectID&&r.JSONRPCType=="CallableReference"){return new JSONRpcClient(this.serverURL,this.user,this.pass,r.objectID,r.javaClass,r.JSONRPCType)}r=JSONRpcClient.extractCallableReferences(this,r)}if(obj.fixups){applyFixups(r,obj.fixups)}return r};JSONRpcClient.extractCallableReferences=function(b,a){var d,c,e;for(d in a){if(typeof(a[d])=="object"){c=JSONRpcClient.makeCallableReference(b,a[d]);if(c){a[d]=c}else{c=JSONRpcClient.extractCallableReferences(b,a[d]);a[d]=c}}if(typeof(d)=="object"){c=JSONRpcClient.makeCallableReference(b,d);if(c){e=a[d];delete a[d];a[c]=e}else{c=JSONRpcClient.extractCallableReferences(b,d);e=a[d];delete a[d];a[c]=e}}}return a};JSONRpcClient.makeCallableReference=function(a,b){if(b&&b.objectID&&b.javaClass&&b.JSONRPCType=="CallableReference"){return new JSONRpcClient(a.serverURL,a.user,a.pass,b.objectID,b.javaClass,b.JSONRPCType)}return null};JSONRpcClient.http_spare=[];JSONRpcClient.http_max_spare=8;JSONRpcClient.poolGetHTTPRequest=function(){if(JSONRpcClient.http_spare.length>0){return JSONRpcClient.http_spare.pop()}return JSONRpcClient.getHTTPRequest()};JSONRpcClient.poolReturnHTTPRequest=function(a){if(JSONRpcClient.http_spare.length>=JSONRpcClient.http_max_spare){delete a}else{JSONRpcClient.http_spare.push(a)}};JSONRpcClient.msxmlNames=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","Microsoft.XMLHTTP"];JSONRpcClient.getHTTPRequest=function(){try{JSONRpcClient.httpObjectName="XMLHttpRequest";return new XMLHttpRequest()}catch(b){}for(var a=0;a<JSONRpcClient.msxmlNames.length;a++){try{JSONRpcClient.httpObjectName=JSONRpcClient.msxmlNames[a];return new ActiveXObject(JSONRpcClient.msxmlNames[a])}catch(b){}}JSONRpcClient.httpObjectName=null;throw new JSONRpcClient.Exception(0,"Can't create XMLHttpRequest object")};