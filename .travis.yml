sudo: required

git:
  depth: false

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
  jobs:
    - REPOSITORY: stretch
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
      ARCHITECTURE: amd64
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: amd64
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: i386
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build-${ARCHITECTURE}
- openssl aes-256-cbc -K $encrypted_4573965c4e34_key -iv $encrypted_4573965c4e34_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      - secure: GnJu/m42iisjZMoThzAkx47/n10iw+rm7lENF3WIonZAHE9wVY4piC3N2jyLaeNygF5uSjEbiLagYCYPmzxmERds4UVdVYxNcutb5E3QMRIg0Y4w+YvfF6nz+d1HLf0FaRJsQGTJi1gy/XiexKRyBJL4dfdno0nQW3Gr0AnLCawZDR4BfEaXakqVl7yk3Y/RUx4gWo3pgw51dOyaXDTsCoLUAJPS6hJsaUXx87pyD19aH1kzR2tPXLviRvuu9gB2ya52oDdI6zhMgIMBEuMRw9RNb9DyP9Y1YlPHVUjYQ+JldgvHO6Cal0B3SueAVXn5RzW60P4sOQcygarIKZVjxDBbmqXiEKrVkDctOtd6uipY7pPa0ZAQZxGmttSlS9wlBxyR0lCemQRvk9jK4rUKOgIfQ5lDvSS5Hxq3vtpCinotglaRsbugI7zeTZbxUep3k9p2ZQwYOpqF11+oq2FffACnLAcKzgIAeTrtzOR2nkD6jRAKQFWedsKgAZIQkFs9H9mDDuwJI5cTwOle7EdCWH4g/aqIRbGctxpvusslAun0rBApTup93QUvXl7PZsI33pmHGcyJX9XEWC1WFwueAmTtVsom4+k7olQHMOxrb///kNgISjcBpa4FJ0hsSjzFSzaEHD9dMoswkSriX+Jg65n9T7KA99sc7AoNwmEnfs8=
    on_success: always
    on_failure: always
