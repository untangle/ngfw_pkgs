sudo: required

git:
  depth: false

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
  jobs:
    - REPOSITORY: stretch
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
      ARCHITECTURE: amd64
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: amd64
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: i386
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build-${ARCHITECTURE}
- openssl aes-256-cbc -K $encrypted_43711b6157b7_key -iv $encrypted_43711b6157b7_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      secure: "iAbQKMELDfEbl9Pf4RINoFc1XW/WpI0pmMFzrUsUUgECWxA3MuOCBgUxXb79OZQSTtxcsaA70wmEnHyEuPwEe5ZRedA9zl7sw1CdPvz626yD+Tyo5miB+ZoN5YbXRSeIfrzc3zhaTG2Li9nE9QHofXRtWJ3nbqE9uLg1em6DaFxbyJsOkIrTR1+5vaZSnW502QtjMp+O+thimaPn1ZZ62oKl6w7PmB/pvIHpCJvrOK9J2w34YS0y8tJNPXOU7wsdygstMxqH2CBB5rzcwMz7u0MdRs7hcUVUs7uqKmiRscjEo6VUW8AywNTSKsV5UyslA3/Y80YjPxWuhSY31mRjhqf7VVtwuqUQtIkdlctLyaCvl6xjAfzvss73UIMS52O/UQyeMocZsf/LpGMvMOlxQ/Odvs3B0h+4RfDNXCNIDy0p42pxocXVhZxWAYwUyuzopsZ+uuH6Ekf8oiB/i2QBDpinMo7SKTEeyAIUxw4TswJ0Ws7qzOoakwxZ0wSwqsqgbtibEf2MYVO9SedUA6kHC449u9fHQXmQWwoHUqwU7TCjo71iJy2MSls3pJEV8rklDGcfUyXvNT7agZux42beyfb1HPJ/sVMIVi9ngrk9H6GgZWkpw1Qs7zMhXrZtwgDkuoIRzXd/PTaxmcCERyDwrec+lFKSZRSdpBGU5ivn9pk="
    on_success: change
    on_failure: always
