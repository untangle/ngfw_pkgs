sudo: required

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
  jobs:
    - REPOSITORY: stretch
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
    - REPOSITORY: buster
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build
- openssl aes-256-cbc -K $encrypted_4573965c4e34_key -iv $encrypted_4573965c4e34_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      secure: EpJ46A+5mEPigcR6926rOSKpBGu6RRfMwUQC1OTqTcSv7xBZq3WaSIbu7i9iyYYCTw4TZS877A0YQe70zHSAD+IQClsmlnrpKr8t1nbTdhgK3nwcRAtQNUFMrmHeIQzCbP8MW7ZQNmJShPdh01vmJtHD1+j+3mz4agF+EnpCH+57GfWuBx5gN6sC8scPsHkB4BKR0xfg6jsqCjliwgUSZuFPFU7Zi72FQ+/aCj0VPiyTp/8HXT6mdq9NU0ygY0qyshafImDYY2b2GfR9zzrb48pT4a+uuFAf+dRHr1WvMJbGZYYllVQRF9B8T/g9nVkjtFdKqJazXE7hThtOb8htSEvXEVUNNfDEBoZa3QNrHclFzImBlFljH5eRoFJBnq75jPb9fMO/C210HB3LqwnW1vUVOWSo2eAEFz2xJe1a75owOIkQ3VEmVYIrmE2ivSaqem1/oEf6l0mYTm7D4SHEkOyFjzJOQq3WJEzvl0EkeFHEV6rLQ1BLTmYo5dIG3tyg/xqBNIHiwuSMLVVYOoh8zEJZgeS3exJxvckyWJP03NpQbSc9P1kd+LR9/rEEszBwhxiR97ZyYrUs4z/T4W7/Tb2xUPfYQWx+u+QQLCAJ1cvpLnerll/Nq8yFKd7OLX3HVDyHUUaCwsN+X1dNAtVzQZR7hnM+wTHaSCBJWkXdwlw=
    on_success: change
    on_failure: always
