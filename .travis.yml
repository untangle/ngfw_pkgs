sudo: required

git:
  depth: false

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
  jobs:
    - REPOSITORY: stretch
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
      ARCHITECTURE: amd64
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: amd64
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: i386
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build-${ARCHITECTURE}
- openssl aes-256-cbc -K $encrypted_4573965c4e34_key -iv $encrypted_4573965c4e34_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      secure: "Kq5FIzBEvoCwRyuqA1kdspe6ZN/+91duHOEpBe7nfYmDIYIRteBQpNDYQLhqtrSqHwVnWaCQpy39qe4aOqOFtGYeSH8nn4KI6dUKIC14dTQvAEePWppxPRXGxLzIbGws14reC5mV0hViOAhLEU4rBcJREaR/cSPYj+iuw9JnxbEM5bCleBPcZXJEAGuYSLhgofYIp5H+My3LdV1l7uUjWObCX23t/6gMJoOrVan7w6UPOMSr0kFiDYA5gZm5X6ngEF0BZOvW1nu3DArcTTJ1lvqGVuJK2sRMVFUxVkr8/gYOGasHGm/8BKsusco5vHU9R5gSjhnK0w7FAVqZtJ1Ikn+SKnYhwNDxfNY18yB+s7SPFmGxZLXRGpnCAoiqMGQm5U5GyvrXT8mMBuUkbhBnvf31JKQhVbdt7OwabPjICMqcnVTZGSY2T6WSgafJnHVq71Qbx/fkK8VFlX6beonUbGrCtuzb5oY1iQNJ5fFgHjnsmvULp1Agk6sqoEa5RF+EyhzX0FVOK9+T08ToFDJ3VCDA5yc5iCyKZm9ImO9MoTjDRIpUZINAtNlAWYZdEFC/JXyQLoZiuvSUsYroy8ZyMXpvTrDC9s9mwtfAsOdbv+SyzJyIrKbSmU75aRxuQG/iCRbWepH6OxKsQ2EBGS+YewNXX1cSLFPlTNRKjr3bawQ="
    on_success: change
    on_failure: always
