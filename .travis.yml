sudo: required

git:
  depth: false

services:
- docker

env:
  global:
    - SSH_KEY: /tmp/travis-buildbot.rsa
  jobs:
    - REPOSITORY: stretch
      DISTRIBUTION: current
      PKGTOOLS_COMMIT: origin/master
      ARCHITECTURE: amd64
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: amd64
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp
    - REPOSITORY: buster
      DISTRIBUTION: current
      ARCHITECTURE: i386
      PKGTOOLS_COMMIT: origin/master
      UPLOAD: scp

before_install:
- docker pull untangleinc/ngfw:${REPOSITORY}-build-${ARCHITECTURE}
- openssl aes-256-cbc -K $encrypted_4573965c4e34_key -iv $encrypted_4573965c4e34_iv -in .travis/buildbot.rsa.enc -out ${SSH_KEY} -d
- chmod 600 ${SSH_KEY}

script:
- docker-compose -f docker-compose.build.yml run pkgtools
- docker-compose -f docker-compose.build.yml run build

notifications:
  email: false
  slack:
    rooms:
      secure: U0EZY+tSKQQ58j90heg/QCBc82taEohW8d3gWW83LuwdLnH+mi5uLZBGUvjQdrxUaKgh9004YWNF/NSt6X01AeIgsH0QyYTm2m04x3YRJe0+0AH6+/48RTrzETRkn6dSqqgMnUiyy5/8QfKfYqcCKR/+/jJepOww6wABMhKwK+0RbVpK/eC1IVZkNCg2wVJQJskBR9JAUfr9hQNjfe4IPTsOU1pcktHr3URm1I6U3PbP+a7zg2MfkNQ/TNdspVvJJNNreh481Oih0B6gZluGaSAlApbfDBtmz/11o+XuucNia8ZdzN8ZEBuZvFxXTy2MGbjDKIDwkUkLO7APtVVucabx5ZwLu5kx7Is9NoCMZZQeDavJ4qUmsU1Ycsb0JFUQheM05Zz0SpDDkpXy8nCSefUzhZ6Q7khzOaGpc6c07/MqI6Z+EJfRnoRffKBFilSsUYqF9fBhm2Aw5/CWZaS55CbnPmtocEAWLg7jFaMSO/zJn6VC37y5AY7HOhqdQddp8zhADn5gQ/g0k2HeY4Sqk003kCI9UVx0i29q5cFT1CIJ3DhOLZpVebQ27Qr5YaRg7HQTsEk6W9wbyRHNkwa4XBUP838LRK7Zjk7wit71KSrmiyDizge6ftS3T/UuBiRAhWno5utfvIdyYACvI0r/tqfWaXihBsyAIm4K9oVUZw8=
    on_success: change
    on_failure: always
