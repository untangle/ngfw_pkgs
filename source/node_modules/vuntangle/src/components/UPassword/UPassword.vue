<!--
Password field component with reveal password feature and validation

Usage:
<ValidationProvider v-slot="{ errors }" :rules="{ required: true, min: 8 }">
  <u-password v-model="the_password" :label="$t('the_label')" :errors="errors" />
</ValidationProvider
-->
<template>
  <u-text-field
    :value="value"
    :label="hasFocus ? label : ''"
    :placeholder="label"
    :disabled="disabled"
    :type="reveal ? 'text' : 'password'"
    :append-icon="reveal ? 'mdi-eye' : 'mdi-eye-off'"
    :error-messages="errors"
    @click:append="reveal = !reveal"
    @input="$emit('input', $event)"
    @blur="onBlur"
    @focus="onFocus"
  >
    <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
  </u-text-field>
</template>
<script>
  export default {
    props: {
      // `value` is passed via v-model
      value: {
        type: String,
        default: null,
      },
      // field label
      label: {
        type: String,
        require: true,
        default: null,
      },
      // disables the field
      disabled: {
        type: Boolean,
        default: false,
      },
      // errors from validation provider
      errors: {
        type: Array,
        default: () => {
          return []
        },
      },
    },
    data: () => ({
      // flag to show/hide password in plain text
      reveal: false,
      // fix for autocomplete
      hasFocus: false,
    }),
    methods: {
      onFocus() {
        this.hasFocus = true
        this.$emit('focus')
      },
      onBlur() {
        // this.hasFocus = false
        this.$emit('blur')
      },
    },
  }
</script>
