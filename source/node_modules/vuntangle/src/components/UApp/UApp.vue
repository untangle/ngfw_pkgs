<template>
  <!-- use the proper layout based on auth -->
  <u-error v-if="errorCaptured" />
  <component
    :is="$route.meta.layout || defaultLayout"
    v-else
    @update:pageErrorCaptured="value => (pageErrorCaptured = value)"
  />
</template>
<script>
  import { captureException } from '@sentry/vue'
  import UError from '../UError'
  export default {
    components: { UError },
    props: {
      defaultLayout: { type: Object, required: true },

      // can be a translation key or an array of parameters for $t()
      defaultTitle: { type: [String, Array], required: true },
    },
    data() {
      return {
        errorCaptured: false,
        pageErrorCaptured: false,
        metaTitle: null,
      }
    },
    computed: {
      documentTitle() {
        return this.metaTitle
          ? this.$t(this.metaTitle)
          : Array.isArray(this.defaultTitle)
          ? this.$t(...this.defaultTitle)
          : this.$t(this.defaultTitle)
      },
    },
    watch: {
      $route: {
        immediate: true,
        handler(to) {
          this.metaTitle = to.meta.title
        },
      },
      documentTitle: {
        immediate: true,
        handler(newDocumentTitle) {
          document.title = newDocumentTitle
        },
      },
    },
    errorCaptured(err) {
      captureException(err)
      this.errorCaptured = true
      // eslint-disable-next-line no-console
      console.error(err)

      return false
    },
  }
</script>
