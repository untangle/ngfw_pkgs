<template>
  <v-dialog v-model="dialog" :width="width" persistent content-class="modal-border">
    <v-card :disabled="showProgress">
      <v-card-title class="px-4 py-1 aristaMediumBlue white--text">
        {{ title }}
        <v-spacer />
        <v-btn icon @click="$emit('cancel')"><v-icon color="white">mdi-close</v-icon></v-btn>
      </v-card-title>
      <v-divider />

      <div class="pa-4" style="min-height: 100px">
        <!-- default slot -->
        <slot></slot>
      </div>

      <v-card-actions class="px-4 pb-4 pt-0">
        <!-- info or error message to display -->
        <span v-if="message" style="color: #555"> <v-icon small>mdi-information-outline</v-icon> {{ message }} </span>
        <v-spacer />

        <u-btn color="default" class="mr-2" @click="$emit('cancel')">
          <span :class="`${$vuetify.theme.dark ? 'white--text' : ''}`">{{ cancelLabel || $t('cancel') }}</span>
        </u-btn>
        <u-btn :disabled="submitDisabled" @click="$emit('submit')">{{ submitLabel || $t('ok') }}</u-btn>

        <!-- add an extra slot allowing to set extra actions -->
        <div v-if="$slots.extraActions" class="ml-4">
          <slot name="extraActions"></slot>
        </div>
      </v-card-actions>
      <v-overlay :value="showProgress" absolute color="rgba(255, 255, 255, 0.66)" opacity="1" class="text-center">
        <v-progress-circular indeterminate size="32" color="aristaMediumBlue" />
      </v-overlay>
    </v-card>
  </v-dialog>
</template>
<script>
  import {
    VDialog,
    VCard,
    VCardTitle,
    VSpacer,
    VBtn,
    VIcon,
    VDivider,
    VCardActions,
    VOverlay,
    VProgressCircular,
  } from 'vuetify/lib'
  import UBtn from '../UBtn'

  export default {
    components: {
      VDialog,
      VCard,
      VCardTitle,
      VSpacer,
      VBtn,
      VIcon,
      VDivider,
      VCardActions,
      VOverlay,
      VProgressCircular,
      UBtn,
    },
    props: {
      // show/hide dialog
      value: {
        type: Boolean,
        default: false,
      },
      // dialog window title
      title: {
        type: String,
        default: '',
      },
      // custom close buton label, default set as undefined to enable dynamic translation
      cancelLabel: {
        type: String,
        default: undefined,
      },
      // custom action button label, default set as undefined to enable dynamic translation
      submitLabel: {
        type: String,
        default: undefined,
      },
      // boolean to disable/enable submit button
      submitDisabled: {
        type: Boolean,
        default: false,
      },
      // dialog width as a number or percentage
      width: {
        type: [String, Number],
        default: 650,
      },
      // dialog width as a number or percentage
      height: {
        type: [String, Number],
        default: 'auto',
      },
      // boolean to show progress while pending action
      showProgress: {
        type: Boolean,
        default: false,
      },
      // info or error message to show
      message: {
        type: String,
        default: null,
      },
    },
    data() {
      return {
        dialog: this.value,
      }
    },
    watch: {
      value(dialog) {
        // close on ESC key
        const handler = e => {
          if (e.keyCode === 27) {
            window.removeEventListener('keydown', handler)
            this.$emit('cancel')
          }
        }
        if (dialog) {
          window.addEventListener('keydown', handler)
        }

        // mutate data as it is used as v-model for v-dialog and cannot mutate the props
        this.dialog = dialog
      },
    },
  }
</script>
