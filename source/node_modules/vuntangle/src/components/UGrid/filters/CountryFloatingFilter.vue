<template>
  <u-select
    v-model="value"
    :items="items"
    :height="20"
    :outlined="false"
    class="text-body-1"
    single-line
    clearable
    hide-details
    :placeholder="$vuntangle.$t('select')"
    :menu-props="{ offsetY: true, dense: true }"
    @click:clear="value = undefined"
    @change="filter"
  />
</template>
<script>
  import { toLower, startCase } from 'lodash'
  import Vue from 'vue'

  import USelect from '../../USelect'

  export default Vue.extend({
    components: {
      USelect,
    },
    data() {
      return {
        value: null,
        items: Object.keys(this.$vuntangle.util.country_codes).map(cc => ({
          text: startCase(toLower(this.$vuntangle.util.country_codes[cc])),
          value: cc,
        })),
      }
    },
    methods: {
      filter() {
        if (!this.value) {
          // Remove the filter
          this.params.parentFilterInstance(instance => {
            instance.setModel(null)
          })
          return
        }

        this.params.parentFilterInstance(instance => {
          instance.setModel({ value: this.value })
        })
      },

      onParentModelChanged(parentModel) {
        this.value = parentModel?.value || null
      },
    },
  })
</script>
