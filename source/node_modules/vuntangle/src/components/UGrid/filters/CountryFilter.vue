<template>
  <div style="width: 240px">
    <div v-if="!params.disabled">
      <v-list dense class="pa-0" color="transparent">
        <v-list-item>
          <v-list-item-icon class="mr-2"><v-icon small v-text="`mdi-filter`" /></v-list-item-icon>
          <v-list-item-content><v-list-item-title v-text="$vuntangle.$t('filter')" /></v-list-item-content>
          <v-list-item-action v-if="filterActive" class="my-0 v-application">
            <v-btn x-small elevation="0" color="primary" @click="value = null" v-text="$vuntangle.$t('clear')" />
          </v-list-item-action>
        </v-list-item>
      </v-list>
      <div class="my-3" style="width: 235px">
        <v-select
          v-model="value"
          :items="items"
          attach
          dense
          single-line
          hide-details
          :label="$vuntangle.$t('select')"
          :menu-props="{ offsetY: true, dense: true }"
        />
      </div>
      <v-divider class="mt-4 pt-4" />
    </div>
    <column-menu :params="params" />
  </div>
</template>
<script>
  import { toLower, startCase } from 'lodash'
  import Vue from 'vue'

  // import vuetify components
  import {
    VList,
    VListItem,
    VListItemIcon,
    VIcon,
    VListItemContent,
    VListItemTitle,
    VListItemAction,
    VBtn,
    VSelect,
    VDivider,
  } from 'vuetify/lib'

  import ColumnMenu from '../components/ColumnMenu'

  export default Vue.extend({
    components: {
      ColumnMenu,
      VList,
      VListItem,
      VListItemIcon,
      VIcon,
      VListItemContent,
      VListItemTitle,
      VListItemAction,
      VBtn,
      VSelect,
      VDivider,
    },
    data() {
      return {
        value: null,
        items: Object.keys(this.$vuntangle.util.country_codes).map(cc => ({
          text: startCase(toLower(this.$vuntangle.util.country_codes[cc])),
          value: cc,
        })),
        filterActive: false,
      }
    },
    watch: {
      value() {
        this.params.filterChangedCallback()
      },
    },
    created() {
      this.valueGetter = this.params.valueGetter
    },
    methods: {
      isFilterActive() {
        this.filterActive = !!this.value
        return this.filterActive
      },

      doesFilterPass(params) {
        return this.value.includes(this.valueGetter(params.node))
      },

      getModel() {
        return { value: this.value }
      },

      setModel(model) {
        this.value = model?.value || null
      },
    },
  })
</script>
<style scoped>
  /deep/ .v-label,
  /deep/ .v-select__selection {
    padding-left: 5px;
  }
</style>
