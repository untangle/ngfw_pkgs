<template>
  <div style="width: 240px">
    <div v-if="!params.disabled">
      <v-list dense class="pa-0" color="transparent">
        <v-list-item>
          <v-list-item-icon class="mr-2"><v-icon small v-text="`mdi-filter`" /></v-list-item-icon>
          <v-list-item-content><v-list-item-title v-text="$vuntangle.$t('filter')" /></v-list-item-content>
          <v-list-item-action :style="{ visibility: filterActive ? 'visible' : 'hidden' }" class="my-0 v-application">
            <v-btn x-small elevation="0" color="primary" @click="text = ''" v-text="$vuntangle.$t('clear')" />
          </v-list-item-action>
        </v-list-item>
        <v-list-item class="px-0">
          <u-text-field
            ref="input"
            v-model="text"
            :placeholder="`${$vuntangle.$t('filter')}...`"
            @input="params.filterChangedCallback()"
          />
        </v-list-item>
      </v-list>
      <v-divider class="mt-4" />
    </div>
    <column-menu :params="params" />
  </div>
</template>
<script>
  import Vue from 'vue'

  // import vuetify components
  import {
    VList,
    VListItem,
    VListItemIcon,
    VIcon,
    VListItemContent,
    VListItemTitle,
    VListItemAction,
    VBtn,
    VDivider,
  } from 'vuetify/lib'
  import ColumnMenu from '../components/ColumnMenu'
  import UTextField from '../../UTextField'

  export default Vue.extend({
    components: {
      ColumnMenu,
      VList,
      VListItem,
      VListItemIcon,
      VIcon,
      VListItemContent,
      VListItemTitle,
      VListItemAction,
      VBtn,
      VDivider,
      UTextField,
    },
    data() {
      return {
        text: '',
        valueGetter: null,
        filterActive: false,
      }
    },
    watch: {
      text() {
        this.params.filterChangedCallback()
      },
    },
    created() {
      this.valueGetter = this.params.valueGetter
    },
    methods: {
      isFilterActive() {
        this.filterActive = this.text !== null && this.text !== undefined && this.text !== ''
        return this.filterActive
      },

      doesFilterPass(params) {
        return this.valueGetter(params.node)?.toString().toLowerCase().includes(this.text.toLowerCase())
      },

      getModel() {
        return { value: this.text }
      },

      setModel(model) {
        this.text = model?.value || null
      },

      afterGuiAttached() {
        if (this.$refs.input) {
          this.$refs.input.focus()
        }
      },
    },
  })
</script>
