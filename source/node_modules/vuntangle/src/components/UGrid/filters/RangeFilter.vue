<template>
  <div style="width: 240px">
    <div v-if="!params.disabled">
      <v-list dense class="pa-0" color="transparent">
        <v-list-item>
          <v-list-item-icon class="mr-2"><v-icon small v-text="`mdi-filter`" /></v-list-item-icon>
          <v-list-item-content><v-list-item-title v-text="$vuntangle.$t('filter')" /></v-list-item-content>
          <v-list-item-action v-show="filterActive" class="my-0 v-application">
            <v-btn x-small elevation="0" color="primary" @click="range = [0, 100]" v-text="$vuntangle.$t('clear')" />
          </v-list-item-action>
        </v-list-item>
      </v-list>

      <v-range-slider
        v-model="range"
        hide-details
        min="0"
        max="100"
        class="mx-4"
        :step="params.step"
        @end="params.filterChangedCallback()"
      />
      <p class="text-center">{{ range[0] }}% - {{ range[1] }}%`</p>
      <v-divider class="mt-4" />
    </div>
    <column-menu :params="params" />
  </div>
</template>
<script>
  import Vue from 'vue'

  // import vuetify components
  import {
    VList,
    VListItem,
    VListItemIcon,
    VIcon,
    VListItemContent,
    VListItemTitle,
    VListItemAction,
    VBtn,
    VRangeSlider,
    VDivider,
  } from 'vuetify/lib'

  import ColumnMenu from '../components/ColumnMenu'

  export default Vue.extend({
    components: {
      ColumnMenu,
      VList,
      VListItem,
      VListItemIcon,
      VIcon,
      VListItemContent,
      VListItemTitle,
      VListItemAction,
      VBtn,
      VRangeSlider,
      VDivider,
    },
    data: () => ({
      range: [0, 100],
      valueGetter: null,
      filterActive: false,
    }),
    watch: {
      range() {
        this.params.filterChangedCallback()
      },
    },
    created() {
      this.valueGetter = this.params.valueGetter
      this.step = this.params.step || 1
    },
    methods: {
      isFilterActive() {
        this.filterActive = this.range[0] > 0 || this.range[1] < 100
        return this.filterActive
      },

      doesFilterPass(params) {
        return (
          !isNaN(this.valueGetter(params.node)) &&
          this.valueGetter(params.node) > this.range[0] &&
          this.valueGetter(params.node) < this.range[1]
        )
      },

      getModel() {
        return { range: this.range }
      },

      setModel(model) {
        this.range = model?.range || [0, 100]
      },
    },
  })
</script>
