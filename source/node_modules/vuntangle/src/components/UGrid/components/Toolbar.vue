<template>
  <div class="d-flex flex-column">
    <v-divider v-if="toolbar === 'bottom'" />
    <v-sheet :class="`d-flex flex-row align-center pa-1 gap-1 ${extraClass}`">
      <template v-if="enableQuickFilter">
        <u-text-field
          v-if="autoFilter"
          v-model="text"
          clearable
          style="max-width: 500px"
          :placeholder="$vuntangle.$t('filter_placeholder')"
          @input="$emit('update:quickFilterText', text)"
        />
        <template v-else>
          <u-text-field
            v-model="text"
            clearable
            style="max-width: 500px"
            :placeholder="$vuntangle.$t('filter_placeholder')"
            @keyup.enter="$emit('update:quickFilterText', text)"
          />
          <v-btn x-small depressed class="primary white--text ml-4" @click="$emit('update:quickFilterText', text)">
            {{ $vuntangle.$t('filter') }}
          </v-btn>
        </template>
        <v-btn v-if="showClear" small text color="primary" class="ml-2" @click="$emit('clear-all-filters')">
          {{ $vuntangle.$t('clear_all_filters') }}
        </v-btn>
      </template>
      <div v-else class="py-6" />
      <v-spacer />
      <span v-if="!totalCount" class="pl-2 text-caption">{{
        $vuntangle.$t('filtered_text', { filtered: filteredNumber, total: filteredTotal })
      }}</span>
      <span v-if="showMultipleSelectionText" class="pl-1 text-caption">{{
        $vuntangle.$t('selected_text', { selected: selectedNumber })
      }}</span>
      <slot name="toolbarActions"></slot>
      <v-divider v-if="enableExportCsv || enableRefresh" vertical class="mx-4" />

      <v-btn v-if="enableCondensedToggle" icon class="mr-2" @click="$emit('update:condensed-grid', !condensedGrid)">
        <v-icon>{{ condensedIcon }}</v-icon>
      </v-btn>
      <v-btn
        v-if="enableExportCsv"
        small
        depressed
        class="primary white--text mr-2"
        :disabled="fetching"
        @click="$emit('export-csv')"
      >
        {{ $vuntangle.$t('export_csv') }}
      </v-btn>
      <v-btn
        v-if="enableRefresh"
        small
        depressed
        color="primary"
        class="mr-2"
        :disabled="fetching"
        @click="$emit('refresh')"
      >
        {{ $vuntangle.$t('refresh') }}
      </v-btn>
    </v-sheet>
    <v-divider v-if="toolbar === 'top'" />
  </div>
</template>
<script>
  // import vuetify components
  import { VSheet, VSpacer, VDivider, VBtn } from 'vuetify/lib'
  import UTextField from '../../UTextField'

  export default {
    components: { VSheet, VSpacer, VDivider, VBtn, UTextField },
    inject: {
      $totalCount: {
        default: undefined,
      },
    },
    props: {
      autoFilter: { type: Boolean, default: true },
      quickFilterText: { type: String, default: null },
      toolbar: { type: String, default: null },
      selectedNumber: { type: Number, default: null },
      filteredNumber: { type: Number, default: null },
      filteredTotal: { type: Number, default: null },
      enableRefresh: Boolean,
      enableExportCsv: Boolean,
      enableQuickFilter: { type: Boolean, default: true },
      showMultipleSelectionText: { type: Boolean, default: false },
      fetching: { type: Boolean, default: false },
      enableCondensedToggle: { type: Boolean, default: false },
      condensedGrid: { type: Boolean, default: true },
      showClear: { type: Boolean, default: false },
    },
    data: () => ({
      text: '',
    }),
    computed: {
      totalCount: ({ $totalCount }) => ($totalCount ? $totalCount() : undefined),
      extraClass() {
        if (this.toolbar === 'bottom') {
          return 'bottom'
        }
        if (this.toolbar === 'float') {
          return 'float transition-fast-in-fast-out'
        }
        return ''
      },
      condensedIcon: ({ condensedGrid }) =>
        condensedGrid ? 'mdi-arrow-expand-vertical' : 'mdi-arrow-collapse-vertical',
    },
    watch: {
      quickFilterText(value) {
        this.text = value
      },
    },
  }
</script>
