const SentryWebpackPlugin = require('@sentry/webpack-plugin')

/**
 * Automatically upload the sourcemap if a SENTRY_AUTH_TOKEN was passed in on the build.  This is used to create
 * releases with the sourcemaps. Can be used in a webpack config like:
 *
 * modules.export = {
 *   plugins: uploadSentrySourceMaps('vuntangle', './dist'),
 * }
 *
 * @param {Object}       options any options for the SentryWebpackPlugin
 * @param {string|array}
 *
 * @returns {array}
 */
module.exports = (options = {}) => {
  // return no plugin if hte auth token was not found
  if (!process.env.SENTRY_AUTH_TOKEN) {
    return []
  }

  const date = new Date()
  return [
    new SentryWebpackPlugin({
      authToken: process.env.SENTRY_AUTH_TOKEN,
      org: 'aristanetworks',
      release: `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()} ${String(date.getHours()).padStart(
        2,
        '0',
      )}:${String(date.getMinutes()).padStart(2, '0')}:${String(date.getSeconds()).padStart(2, '0')}`,
      ...options,
    }),
  ]
}
