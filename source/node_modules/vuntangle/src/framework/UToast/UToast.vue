<template>
  <transition-group name="fade" tag="div" class="toast-container">
    <u-toast-message
      v-for="toastMessage in toastMessages"
      :id="toastMessage.id"
      :key="`toastMessage${toastMessage.id}`"
      :color="toastMessage.type"
      :timeout="toastMessage.type === 'error' ? -1 : 5000"
      :show-dialog="true"
      :text="toastMessage.message"
      @close-dialog="deleteToast"
    />
  </transition-group>
</template>
<script>
  import UToastMessage from './UToastMessage'

  export default {
    components: { UToastMessage },
    data() {
      return {
        toastMessages: [],

        // hold a unique ID for each toast message, this is used for removing
        // the message
        toastMessageId: 1,
      }
    },
    created() {
      this.$vuntangle.vm.$on('add-toast', this.addToast)
      this.$vuntangle.vm.$on('clear-toasts', this.clearToasts)
    },
    methods: {
      addToast({ message, type }) {
        // errors do not get removed automatically, so do not display duplicate errors
        if (type === 'error' && this.toastMessages.find(toastMessage => toastMessage.message === message)) {
          return
        }

        this.toastMessages.push({ id: this.toastMessageId++, message, type })
      },
      deleteToast(id) {
        const toastMessageIndex = this.toastMessages.findIndex(r => r.id === id)
        if (toastMessageIndex !== -1) {
          this.toastMessages.splice(toastMessageIndex, 1)
        }
      },
      clearToasts() {
        this.toastMessages = []
      },
    },
  }
</script>
<style lang="scss">
  .toast-container {
    z-index: 9999;
    position: fixed;
    top: 4px;
    width: auto;
    left: 0;
    right: 0;

    div {
      position: relative !important;
    }
  }

  .fade-enter-active,
  .fade-leave-active {
    transition: opacity 0.5s ease-out;
  }

  .fade-enter,
  .fade-leave-to {
    opacity: 0;
  }
</style>
