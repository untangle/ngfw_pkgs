<template>
  <div class="d-flex flex-column fill-height pa-4">
    <h1 class="headline mb-2">{{ $t('active_sessions') }}</h1>
    <v-card class="d-flex flex-grow-1" outlined>
      <!--
        row-node-id="session_id" was removed as `session_id` could be undefined;
        without it falls back to ag-grid internal mechanism to set row node ids
       -->
      <u-grid
        id="active-sessions"
        no-border
        :row-data="sessions"
        :column-defs="columnDefs"
        :fetching="fetching"
        :selection.sync="selection"
        @refresh="$emit('refresh')"
      />
      <v-expand-x-transition>
        <session-details
          v-if="selection.length"
          :session="selection[0]"
          :column-defs="columnDefs"
          @close="selection = []"
        />
      </v-expand-x-transition>
    </v-card>
  </div>
</template>
<script>
  import { VCard, VExpandXTransition } from 'vuetify/lib'

  import columns from '../../plugins/columns'
  import SessionDetails from './SessionDetails.vue'

  export default {
    components: { VCard, VExpandXTransition, SessionDetails },
    props: {
      // a map between interface ids and names, e.g. { "1": "internal", "2": "WAN0" }
      boxSettings: { type: Object, default: () => {} },
      // the actual sessions data
      sessions: { type: Array, default: () => [] },
      fetching: { type: Boolean, default: false },
    },

    data() {
      return {
        selection: [],
      }
    },

    computed: {
      /** returns all the column defs than adds 2 extra special columns for `interface_id` based on id/name mapping */
      columnDefs: ({ boxSettings }) => columns.buildColumnDefs(columns.gridColumns.active_sessions, boxSettings),
    },
  }
</script>
