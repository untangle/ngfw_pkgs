<template>
  <div class="d-flex flex-column fill-height pa-4">
    <h1 class="headline mb-2">{{ $vuntangle.$t('reports') }}</h1>
    <div class="d-flex flex-row flex-wrap" style="gap: 14px">
      <v-card v-for="(card, key) in cards" :key="key" outlined class="flex-grow-1" style="flex-basis: 30%">
        <v-card-title :class="`py-0 subtitle-1 ${$vuntangle.theme === 'dark' ? '' : 'primary--text'}`">
          <span class="py-2 font-weight-medium">{{ $vuntangle.$t(key) }}</span>
        </v-card-title>
        <v-list dense class="pt-0">
          <v-list-item v-for="view in card" :key="view.id" @click="$emit('view-report', view.id)">
            <v-list-item-content>
              <v-list-item-title>{{ $vuntangle.$t(view.name) }}</v-list-item-title>
              <v-list-item-subtitle class="d-none d-lg-block font-weight-regular caption" style="white-space: unset">
                <span v-for="reportId in view.reports" :key="reportId" class="mr-4">
                  <v-icon small>{{ reports[reportId].icon }}</v-icon> {{ $vuntangle.$t(reports[reportId].title) }}
                </span>
              </v-list-item-subtitle>
            </v-list-item-content>
          </v-list-item>
        </v-list>
      </v-card>
      <div class="flex-grow-1" style="flex-basis: 30%"></div>
    </div>
  </div>
</template>
<script>
  import { VCard, VCardTitle, VList, VListItem, VListItemTitle, VListItemSubtitle, VIcon } from 'vuetify/lib'

  import reports from '../../plugins/reports'
  import { Category } from './configs/constants'
  import { views } from './configs/viewsConfig'

  export default {
    components: { VCard, VCardTitle, VList, VListItem, VListItemTitle, VListItemSubtitle, VIcon },

    props: {
      features: { type: Object, required: true },
    },

    data() {
      return {
        reports,
      }
    },

    computed: {
      /**
       * Returns all the available categories
       * @returns {Array<String>}
       */
      categories: () => Object.values(Category),

      /**
       * Returns all the available report views
       * @returns {Array<View>}
       */
      views: () => Object.values(views),

      /**
       * Returns a mapping between category names and report views shown as cards on this landing page
       * @param {Object} vm
       * @param {Array<String>}    vm.categories
       * @param {Array<View>} vm.views
       * @returns {Object}
       */
      cards: ({ categories, views, features }) =>
        categories.reduce((cards, category) => {
          cards[category] = views.filter(view => view.category === category)

          // don't show policy-manager if hasApplianceSettings is false, appliance version is lower than 5.1
          if (!features?.hasApplianceSettings && category === Category.PolicyManager) {
            delete cards[Category.PolicyManager]
          }

          return cards
        }, {}),
    },
  }
</script>
