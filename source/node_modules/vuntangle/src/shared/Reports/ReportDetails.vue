<template>
  <div v-if="view" class="d-flex flex-column fill-height">
    <reports-nav :view-id="viewId" class="ma-4" v-on="$listeners" />
    <div class="d-flex flex-column flex-grow-1 overflow-auto px-4 pb-4" style="flex-basis: 0">
      <component :is="view.component" :view="view" v-on="$listeners"></component>
    </div>
  </div>
</template>
<script>
  import { views } from './configs/viewsConfig'
  import ReportsNav from './components/ReportsNav.vue'

  import {
    GenericChart,
    GenericGrid,
    WebFilterSummary,
    WebFilterVisitedSites,
    GeoipBlockedSessions,
    GeoipDistributionMap,
    ApplicationControlApplications,
    AllSessions,
  } from './views'

  export default {
    components: {
      ReportsNav,

      GenericChart,
      GenericGrid,
      WebFilterSummary,
      WebFilterVisitedSites,
      GeoipBlockedSessions,
      GeoipDistributionMap,
      ApplicationControlApplications,
      AllSessions,
    },

    /**
     * provide box settings and time range to be used (injected) in any child components
     */
    provide() {
      return {
        $boxSettings: this.boxSettings,
        $applianceUid: () => this.applianceUid,
        $timeRange: () => this.timeRange,
        $totalCount: () => this.totalCount,
        $pagination: () => this.pagination,
      }
    },

    props: {
      viewId: { type: String, default: undefined },
      boxSettings: { type: Object, default: undefined },
      applianceUid: { type: String, default: undefined },
      totalCount: { type: Number, default: undefined },
    },

    data() {
      return {
        // the initial TimeRange period
        timeRange: { period: [-24, 0] },
        pagination: { pageNumber: 1, pageSize: 100 },
      }
    },

    computed: {
      /**
       * Returns the view config based on id
       * @param {Object} vm
       * @param {String} vm.viewId
       * @returns {View}
       */
      view: ({ viewId }) => views[viewId],
    },

    /**
     * if the view/report is not found then emit event to handle the issue
     */
    watch: {
      view: {
        handler(view) {
          if (!view) this.$emit('report-not-found')
        },
        immediate: true,
      },
    },
  }
</script>
