<template>
  <div class="d-flex flex-column flex-grow-1">
    <div class="d-flex align-center mb-4">
      <v-radio-group v-model="filter" row class="ma-0" hide-details>
        <v-radio
          v-for="item in filterItems"
          :key="item.text"
          :label="$vuntangle.$t(item.text)"
          :value="item.value"
          hide-details
          :ripple="false"
        />
      </v-radio-group>
    </div>

    <report-grid :report="reports[0]" :custom-conditions="customConditions" v-on="$listeners" />
  </div>
</template>
<script>
  import { VRadioGroup, VRadio } from 'vuetify/lib'
  import ReportGrid from '../components/ReportGrid.vue'
  import viewsMixin from './viewsMixin'

  export default {
    components: { VRadioGroup, VRadio, ReportGrid },
    mixins: [viewsMixin],

    data() {
      return {
        filter: '',
        // used to update report query conditions
        filterItems: [
          { text: 'all', value: '' },
          { text: 'rejected', value: 'application_control_rejected' },
          { text: 'blocked', value: 'application_control_blocked' },
          { text: 'flagged', value: 'application_control_flagged' },
          { text: 'bypassed', value: 'application_control_bypassed' },
        ],
      }
    },

    computed: {
      /**
       * Returns custom conditions based on filtering options
       * @param {Object} vm
       * @param {String} vm.filter - the filter field
       * @returns {Array<QueryCondition>}
       */
      customConditions: ({ filter }) => {
        if (!filter) return []

        if (filter === 'application_control_bypassed') {
          // application_control_bypassed would contain a non-empty string in reports.db
          return [
            {
              column: filter,
              operator: 'NE',
              value: '',
            },
          ]
        }
        return [
          {
            column: filter,
            operator: 'EQ',
            value: true,
          },
        ]
      },
    },
  }
</script>
