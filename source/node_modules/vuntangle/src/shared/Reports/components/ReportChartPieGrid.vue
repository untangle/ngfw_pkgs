<template>
  <u-grid id="pie-grid" :column-defs="columnDefs" :row-data="data" toolbar="hidden" no-border @refresh="onRefresh" />
</template>
<script>
  import renderer from '../../../plugins/renderer'
  import columns from '../../../plugins/columns'

  export default {
    props: {
      /**
       * a data element structure represents the count of a specific field value encounters
       * { <field_name>: 'some_name', value: <count_value> }
       */
      data: { type: Array, default: () => [] },
      /**
       * The report configuration
       */
      report: { type: Object, default: undefined },
    },

    computed: {
      /**
       * Returns the columns definition to be shown to the side grid of the pie chart
       * @param {Object} vm
       * @param {Object} vm.$i18n - the translation engine
       * @param {Report} vm.report - the report configuration
       * @returns {Array<Object>}
       */
      columnDefs: ({ $i18n, report }) => {
        /**
         * report.rendering.column represents the field for which colDef is retrieved via  `buildColumnDefs`
         * units column def is computed based on the report.rendering.units
         */
        const column = report.rendering?.column
        const units = report.rendering?.units

        return [
          ...columns.buildColumnDefs({ all: [column] }),
          {
            headerName: $i18n.t(units),
            field: 'value',
            sort: 'desc',
            cellRenderer: ({ value }) => {
              if (units === 'bytes/s') return renderer.bytesSecRenderer(value)
              if (units === 'bytes') return renderer.bytesRenderer(value)
              return value
            },
          },
        ]
      },
    },
    methods: {
      onRefresh() {
        this.$emit('refresh')
      },
    },
  }
</script>
