<template>
  <v-container>
    <ValidationObserver ref="obs">
      <v-row>
        <v-col>
          <ValidationProvider v-slot="{ errors }" rules="required">
            <u-text-field v-model="settingsCopy.displayName" :label="$vuntangle.$t('name')" :error-messages="errors">
              <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
            </u-text-field>
          </ValidationProvider>
        </v-col>
      </v-row>
      <v-row>
        <v-col>
          <ValidationProvider v-slot="{ errors }" rules="required">
            <u-select
              v-model="settingsCopy.interfaceId"
              :items="interfaceItems"
              :label="$t('interface')"
              :error-messages="errors"
            >
              <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
            </u-select>
          </ValidationProvider>
        </v-col>
      </v-row>
    </ValidationObserver>
  </v-container>
</template>
<script>
  import { VContainer, VRow, VCol } from 'vuetify/lib'
  import { ValidationObserver, ValidationProvider } from 'vee-validate'
  import settingsMixin from '../settingsMixin'
  import util from '../../plugins/util'

  export default {
    components: {
      VContainer,
      VRow,
      VCol,
      ValidationObserver,
      ValidationProvider,
    },
    mixins: [settingsMixin],
    props: {
      // settings, settingsCopy from mixin
      interfaces: { type: Array, default: () => [] },
      index: { type: Number, default: undefined },
    },
    computed: {
      isAdd: ({ index }) => index === undefined,
      interfaceItems: ({ interfaces }) => interfaces.map(intf => ({ value: intf.interfaceId, text: intf.name })),
    },
    methods: {
      // Dialog main action emitting updated settings
      async action() {
        const isValid = await this.$refs.obs.validate()
        if (!isValid) return

        if (this.isAdd) {
          this.settingsCopy.name = util.uuidv4()
        }

        this.$emit('update', this.settingsCopy, this.index)
        this.$emit('close')
      },
    },
  }
</script>
