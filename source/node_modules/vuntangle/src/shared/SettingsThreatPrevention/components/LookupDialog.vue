<template>
  <v-container class="px-0" style="min-height: 180px">
    <ValidationObserver v-slot="{ passes }" tag="div" class="d-flex">
      <ValidationProvider v-slot="{ errors }" tag="div" class="d-flex flex-grow-1" rules="required|ip">
        <u-text-field
          v-model="ipAddress"
          :label="$t('enter_ip_address')"
          :error-messages="errors"
          :disabled="fetching"
          clearable
          @keyup.enter="passes(onLookup)"
        >
          <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
        </u-text-field>
      </ValidationProvider>
      <u-btn :disabled="fetching" height="40" class="ml-4" @click="passes(onLookup)">{{ $t('lookup') }}</u-btn>
    </ValidationObserver>

    <v-divider class="my-4" />

    <v-progress-circular v-if="fetching" indeterminate size="32" color="primary" />

    <div v-if="!fetching">
      <p v-if="outgoing">
        {{ resultIpAddress }} {{ $t('is_considered') }} <b>{{ $t(outgoing) }}</b> ({{ $t('outgoing') }})
      </p>
      <p v-if="incoming">
        {{ resultIpAddress }} {{ $t('is_considered') }} <b>{{ $t(incoming) }}</b> ({{ $t('incoming') }})
      </p>
    </div>
  </v-container>
</template>
<script>
  import { VContainer, VDivider, VProgressCircular } from 'vuetify/lib'
  import { ValidationObserver, ValidationProvider } from 'vee-validate'

  export default {
    components: { VContainer, VDivider, VProgressCircular, ValidationObserver, ValidationProvider },
    data: () => ({
      ipAddress: '',
      incoming: null,
      outgoing: null,
      resultIpAddress: null,
      fetching: false,
    }),
    methods: {
      async onLookup() {
        this.incoming = null
        this.outgoing = null
        this.fetching = true
        await this.$emit('lookup', this.ipAddress, result => {
          this.incoming = result.incoming
          this.outgoing = result.outgoing
        })
        this.resultIpAddress = this.ipAddress
        this.fetching = false
      },
      action() {},
    },
  }
</script>
