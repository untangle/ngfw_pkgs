<template>
  <v-container class="px-0">
    <ValidationObserver ref="obs">
      <v-row>
        <v-col>
          <ValidationProvider v-slot="{ errors }" rules="required">
            <u-text-field v-model="entry.name" :label="$vuntangle.$t('name')" :error-messages="errors">
              <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
            </u-text-field>
          </ValidationProvider>
        </v-col>
      </v-row>
      <v-row>
        <v-col>
          <ValidationProvider v-slot="{ errors }" rules="required">
            <u-text-field v-model="entry.description" :label="$vuntangle.$t('description')" :error-messages="errors">
              <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
            </u-text-field>
          </ValidationProvider>
        </v-col>
      </v-row>
      <v-row>
        <v-col>
          <ValidationProvider v-slot="{ errors }" rules="required|ip_any">
            <u-text-field v-model="entry.address" :label="$vuntangle.$t('address')" :error-messages="errors">
              <template v-if="errors.length" #append><u-errors-tooltip :errors="errors" /></template>
            </u-text-field>
          </ValidationProvider>
        </v-col>
      </v-row>
    </ValidationObserver>
  </v-container>
</template>
<script>
  import { VContainer, VRow, VCol } from 'vuetify/lib'
  import { ValidationObserver, ValidationProvider } from 'vee-validate'
  import UTextField from '../../components/UTextField'

  export default {
    components: {
      VContainer,
      VRow,
      VCol,
      ValidationObserver,
      ValidationProvider,
      UTextField,
    },
    props: {
      index: { type: Number, required: false, default: null },
      settings: { type: Object, required: false, default: () => ({ name: '', description: '', address: '' }) },
    },
    data: () => ({
      entry: undefined,
    }),

    watch: {
      // copy the prop to the data model that can be mutated
      settings: {
        immediate: true,
        deep: true,
        handler(value) {
          this.entry = { ...value }
        },
      },
    },
    methods: {
      // check validation, send update event with updated entry, close dialog
      async action() {
        const isValid = await this.$refs.obs.validate()
        if (!isValid) return

        this.$emit('update', { ...this.entry }, this.index)
        this.$emit('close')
      },
    },
  }
</script>
