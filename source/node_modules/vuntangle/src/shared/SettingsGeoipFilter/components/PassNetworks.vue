<template>
  <div class="d-flex flex-column flex-grow-1">
    <h3 class="d-flex">
      <span>{{ $t('pass_networks') }}</span>
      <v-spacer />
      <u-btn :min-width="null" @click="onEditNetwork(null)">{{ $t('add_network') }}</u-btn>
    </h3>

    <p>{{ $t('pass_networks_description') }}</p>

    <u-grid
      v-if="settings.passedNetworks.length"
      id="pass-networks"
      :enable-export-csv="false"
      :enable-quick-filter="false"
      :enable-refresh="false"
      :row-data="settings.passedNetworks"
      :column-defs="columnDefs"
      toolbar="none"
    />

    <div v-else class="text-center">
      <p class="body-1 mt-12"><v-icon dense class="mr-2">mdi-information</v-icon>{{ $t('no_networks') }}</p>
    </div>
  </div>
</template>
<script>
  import { VSpacer } from 'vuetify/lib'
  import cloneDeep from 'lodash/cloneDeep'
  import UGrid from '../../../components/UGrid/UGrid.vue'
  import NetworkDialog from './NetworkDialog.vue'

  const actionButtonColumn = {
    width: 30,
    flex: 0,
    resizable: false,
    sortable: false,
    suppressMenu: true,
    cellRenderer: 'ActionButton',
  }

  export default {
    components: {
      VSpacer,
      UGrid,
    },
    props: {
      settings: { type: Object, default: () => {} },
    },
    computed: {
      columnDefs() {
        return [
          { headerName: this.$t('network'), field: 'address' },
          { headerName: this.$t('description'), field: 'description' },
          {
            ...actionButtonColumn,
            cellRendererParams: {
              icon: 'mdi-pencil',
              small: true,
              click: ({ node }) => this.onEditNetwork(node.id),
            },
          },
          {
            ...actionButtonColumn,
            cellRendererParams: {
              icon: 'mdi-delete',
              small: true,
              click: ({ node }) => this.onRemoveNetwork(node.id),
            },
          },
        ]
      },
    },
    methods: {
      onEditNetwork(index = null) {
        this.$vuntangle.dialog.show({
          title: index === null ? this.$t('add_network') : this.$t('edit_network'),
          component: NetworkDialog,
          actionLabel: index === null ? this.$t('add') : this.$t('update'),
          width: 600,
          componentProps: {
            settings: this.settings,
            index,
          },
        })
      },
      onRemoveNetwork(index) {
        const networksCopy = cloneDeep(this.settings.passedNetworks)
        networksCopy.splice(index, 1)

        this.$set(this.settings, 'passedNetworks', networksCopy)
      },
    },
  }
</script>
