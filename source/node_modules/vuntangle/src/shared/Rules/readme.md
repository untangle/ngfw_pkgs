# Rules & Conditions

## Rules

In MFW we have following 5 rules editing sections:
Networking -> Port Forward, NAT, Shaping
Routing -> WAN Rules
Firewall -> Filter, Access

A rule consists of:
- description
- enabled/disabled state
- conditions
- action to take when conditions fulfilled

## Rule Conditions

Below is the full list of available conditions for the rules

```
APPLICATION_NAME(_INFERRED)
APPLICATION_CATEGORY(_INFERRED)
APPLICATION_ID(_INFERRED)
APPLICATION_PRODUCTIVITY(_INFERRED)
APPLICATION_RISK(_INFERRED)
APPLICATION_CONFIDENCE(_INFERRED)
APPLICATION_PROTOCHAIN(_INFERRED)
CLIENT_ADDRESS
CLIENT_ADDRESS_V6
CLIENT_PORT
CLIENT_INTERFACE_TYPE
CLIENT_INTERFACE_ZONE
SERVER_ADDRESS
SERVER_ADDRESS_V6
SERVER_PORT
SERVER_DNS_HINT
SERVER_INTERFACE_TYPE
SERVER_INTERFACE_ZONE
SOURCE_ADDRESS
SOURCE_ADDRESS_V6
SOURCE_ADDRESS_TYPE
SOURCE_PORT
SOURCE_INTERFACE_NAME
SOURCE_INTERFACE_TYPE
SOURCE_INTERFACE_ZONE
DESTINATION_ADDRESS
DESTINATION_ADDRESS_V6
DESTINATION_ADDRESS_TYPE
DESTINATION_PORT
DESTINATION_INTERFACE_NAME
DESTINATION_INTERFACE_TYPE
DESTINATION_INTERFACE_ZONE
DESTINED_LOCAL
IP_PROTOCOL
GEOIP
CT_STATE
```

Each type of rule has a predefined subset of conditions that can be applied to it

## Port Forward Rules

**Rule conditions**
```
DESTINATION_ADDRESS
DESTINATION_ADDRESS_V6
DESTINATION_PORT
DESTINED_LOCAL
SOURCE_ADDRESS
SOURCE_ADDRESS_V6
SOURCE_ADDRESS_TYPE
SOURCE_INTERFACE_NAME
SOURCE_INTERFACE_TYPE
SOURCE_INTERFACE_ZONE
SOURCE_PORT
```
**Rule Action**
```
DNAT (new destination)
```

## Shaping Rules

**Rule conditions**
```
APPLICATION_CATEGORY(_INFERRED)
APPLICATION_NAME(_INFERRED)
APPLICATION_ID(_INFERRED)
APPLICATION_PRODUCTIVITY(_INFERRED)
APPLICATION_RISK(_INFERRED)
CLIENT_ADDRESS
CLIENT_ADDRESS_V6
CLIENT_INTERFACE_TYPE
CLIENT_INTERFACE_ZONE
CLIENT_PORT
IP_PROTOCOL
LIMIT_RATE
BURST_SIZE
SERVER_ADDRESS
SERVER_ADDRESS_V6
SERVER_DNS_HINT
SERVER_INTERFACE_TYPE
SERVER_INTERFACE_ZONE
SERVER_PORT
```
**Rule Action**
```
SET_PRIORITY (priority)
```

## NAT Rules

**Rule conditions**
```
APPLICATION_CATEGORY(_INFERRED)
APPLICATION_CONFIDENCE(_INFERRED)
APPLICATION_ID(_INFERRED)
APPLICATION_NAME(_INFERRED)
APPLICATION_PRODUCTIVITY(_INFERRED)
APPLICATION_PROTOCHAIN(_INFERRED)
APPLICATION_RISK
DESTINATION_ADDRESS
DESTINATION_ADDRESS_V6
DESTINATION_ADDRESS_TYPE
DESTINATION_INTERFACE_NAME
DESTINATION_INTERFACE_TYPE
DESTINATION_INTERFACE_ZONE
DESTINATION_PORT
IP_PROTOCOL
SOURCE_ADDRESS
SOURCE_ADDRESS_TYPE
SOURCE_INTERFACE_NAME
SOURCE_INTERFACE_TYPE
SOURCE_INTERFACE_ZONE
SOURCE_PORT
```
**Rule Actions**
```
SNAT (new source)
MASQUERADE
```

## WAN Rules

**Rule conditions**
```
APPLICATION_CATEGORY_INFERRED
APPLICATION_ID_INFERRED
APPLICATION_NAME_INFERRED
APPLICATION_PRODUCTIVITY_INFERRED
APPLICATION_RISK_INFERRED
DESTINATION_ADDRESS
DESTINATION_ADDRESS_V6
DESTINATION_ADDRESS_TYPE
DESTINATION_PORT
IP_PROTOCOL
GEOIP
SERVER_DNS_HINT
SOURCE_ADDRESS
SOURCE_ADDRESS_V6
SOURCE_ADDRESS_TYPE
SOURCE_INTERFACE_NAME
SOURCE_INTERFACE_TYPE
SOURCE_INTERFACE_ZONE
SOURCE_PORT
```
**Rule Actions**
```
WAN_POLICY (a policy id to apply)
```

## Filter Rules

**Rule conditions**
```
APPLICATION_CATEGORY(_INFERRED)
APPLICATION_ID(_INFERRED)
APPLICATION_NAME(_INFERRED)
APPLICATION_PRODUCTIVITY(_INFERRED)
APPLICATION_RISK(_INFERRED)
CLIENT_ADDRESS
CLIENT_ADDRESS_V6
CLIENT_INTERFACE_TYPE
CLIENT_INTERFACE_ZONE
CLIENT_PORT
CT_STATE
IP_PROTOCOL
SERVER_ADDRESS
SERVER_ADDRESS_V6
SERVER_DNS_HINT
SERVER_INTERFACE_TYPE
SERVER_INTERFACE_ZONE
SERVER_PORT
```
**Rule Actions**
```
ACCEPT
REJECT
DROP
```

## Access Rules

**Rule conditions**
```
CT_STATE
DESTINATION_ADDRESS
DESTINATION_ADDRESS_V6
DESTINATION_PORT
DESTINED_LOCAL
IP_PROTOCOL
SOURCE_ADDRESS
SOURCE_ADDRESS_V6
SOURCE_ADDRESS_TYPE
SOURCE_INTERFACE_NAME
SOURCE_INTERFACE_TYPE
SOURCE_INTERFACE_ZONE
SOURCE_PORT
```
**Rule Actions**
```
ACCEPT
REJECT
DROP
```
