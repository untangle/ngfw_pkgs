const uploadSentrySourceMaps = require('./src/plugins/upload-sentry-source-maps')

module.exports = {
  publicPath: './',
  devServer: {
    port: 3001,
  },
  configureWebpack: {
    resolve: {
      fallback: { 'url': false, 'util': false },
    },
    devtool:
      process.env.NODE_ENV !== 'production' ? 'eval-source-map' : process.env.SENTRY_AUTH_TOKEN ? 'source-map' : false,
    watchOptions: {
      aggregateTimeout: 300,
      poll: 1000,
    },
    performance: {
      hints: false,
    },
    plugins: uploadSentrySourceMaps({ project: 'vuntangle', include: './dist' }),
  },
  /**
   * Add extra webpack rules.  This is only needed in development.
   *
   * @param {Object} config
   */
  chainWebpack: config => {
    // this is a fix for a vue-cli linter/cache bug: https://github.com/vuejs/vue-cli/issues/5399
    config.module.rule('vue').uses.delete('cache-loader')
    config.module.rule('js').uses.delete('cache-loader')
  },
}
