#!/bin/bash

# we don't deal with grub on arm* at all
uname -m | grep -qE '^arm' && exit 0

installDevice=$(echo "get grub-pc/install_devices" | debconf-communicate | awk '{print $2}')

if echo $installDevice | grep -q VBOX_HARDDISK ; then
  # we're on virtualbox, let's see about fixing #12857
  if [ ! -e "$installDevice" ] ; then
    # yep, the install device is gone. grub update will fail, so we'll
    # assume /dev/sda
    echo "set grub-pc/install_devices /dev/sda" | debconf-communicate
  fi
fi

# 15.0 upgrade
if dpkg --compare-versions "$oldVersion" le 15.0~ ; then
  # reboot to new 4.9.0-11 kernel (NGFW-12661)
  nohup /usr/bin/uvm-restart reboot >> /var/log/uvm/restart.log 2>&1 &
fi

exit 0
